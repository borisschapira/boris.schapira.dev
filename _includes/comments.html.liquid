{% comment %}
  Completly snatched from Michael Rose's MadeMistake blog post https://mademistakes.com/articles/improving-jekyll-static-comments/
{% endcomment %}
<section class="reactions post-footer">
  {% if site.data.comments[page.slug] %}
    <!-- Start static comments -->
    <div id="comments">
      <h2>
        {% if site.data.comments[page.slug].size > 1 %}
          {{ site.data.comments[page.slug] | size }} {% t commentaires %}
        {% else %}
          {% t Commentaire %}
        {% endif %}
      </h2>
      {% if site.data.comments[page.slug].size > 0 %}
        <ul class="comments">
        {% assign comments = site.data.comments[page.slug] | where_exp: 'item', "item.replying_to == ''" %}
        {% assign sortedcomments = comments | sort: 'date' %}
        {% for comment in sortedcomments %}
          {% assign index       = forloop.index %}
          {% assign r           = comment.replying_to %}
          {% assign replying_to = r | to_integer %}
          {% assign avatar      = comment.avatar %}
          {% assign email       = comment.email %}
          {% assign name        = comment.name %}
          {% assign url         = comment.url %}
          {% assign date        = comment.date %}
          {% assign message     = comment.message %}
          {% include comment.html.liquid index=index replying_to=replying_to avatar=avatar email=email name=name url=url date=date message=message %}
        {% endfor %}
        </ul>
      {% endif %}
    </div>
    <!-- End static comments -->
  {% endif %}

  {% unless page.comments_locked == true %}
    <!-- Start new comment form -->
    <div id="respond">
      <h3 class="page__section-label">{% t Laisser un commentaire %} <small><a rel="nofollow" id="cancel-comment-reply-link" href="{{ page.url | absolute_url }}#respond" class="npe" style="display:none;">{% t Annuler %}</a></small></h3>

      <form id="comment-form" netlify-honeypot="cb" class="page__form js-form form" method="POST" action="comment" netlify>
        <fieldset>
          <label for="comment-form-message"><strong>{% t Commentaire %}</strong> <small></small></label>
          <textarea type="text" rows="6" id="comment-form-message" name="message" required spellcheck="true"></textarea>
        </fieldset>
        <fieldset>
          <label for="comment-form-name"><strong>{% t Nom %}</strong></label>
          <input type="text" id="comment-form-name" name="name" autocomplete="name" required spellcheck="false">
        </fieldset>
        <fieldset>
          <label for="comment-form-email"><strong>{% t Email %}</strong> <small>({% t facultatif %})</small></label>
          <input type="email" id="comment-form-email" name="email" autocomplete="email" spellcheck="false">
        </fieldset>
        <fieldset>
          <label for="comment-form-url"><strong>{% t Site %}</strong> <small>({% t facultatif %})</small></label>
          <input type="url" id="comment-form-url" name="url" autocomplete="url"/>
        </fieldset>
        <fieldset>
          <label for="comment-form-cb"><strong>{% t Coordonnées de votre planête (uniquement pour les non-humains) %}</strong></label>
          <input type="text" id="comment-form-cb" name="cb" autocomplete="url"/>
        </fieldset>
        <fieldset class="hidden" style="display: none;">
          <input type="hidden" id="comment-post-url" name="origin" value="{{ page.url | absolute_url }}">
          <input type="hidden" id="comment-replying-to" name="replying_to" value="">
          <input type="hidden" id="comment-post-id" name="slug" value="{{ page.slug }}">
        </fieldset>
        <fieldset>
          <button type="submit" id="comment-form-submit" class="btn">{% t Poster le commentaire %}</button>
        </fieldset>
        <p class="info success hidden">
          {% t Commentaire posté avec succès ! %}
        </p>
        <p class="info fail hidden">
          {% t Houston, on a un problème. %}
        </p>
      </form>
    </div>
    <!-- End new comment form -->
  {% else %}
    <p><em>{% t Les commentaires sont clos. %}</em></p>
  {% endunless %}
</section>