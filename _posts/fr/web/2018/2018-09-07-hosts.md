---
title: 'Un fichier hosts pour les bloquer tous'
thumbnail_background: /assets/images/2018-09-07/gollum.jpg
tags:
    - 'Performance Web'
    - Outils
    - Productivit√©
slug: un-fichier-hosts-pour-les-bloquer-tous
translations:
    en: one-host-file-to-block-them-all
---

En tant qu'expert du domaine, les gens me demandent souvent comment am√©liorer la performance des sites Web. Parfois, ils me demandent aussi comment am√©liorer les performances du Web sur leur propre machine, pour leur propre exp√©rience de navigation. Dans ce cas, ma r√©ponse est toujours la m√™me : commencer par le fichier **hosts**.

{% capture img_alt %}Gollum, tenant l'Anneau unique dans l'adaptation du Seigneur des Anneaux de Peter Jackson{% endcapture %} {% capture img_caption %}Je manquais d'inspiration pour trouver une illustration plus sympa‚Ä¶{% endcapture %} {% include rwd-image.html.liquid
path="/assets/images/2018-09-07/gollum.jpg"
alt=img_alt
caption=img_caption
%}

<!-- more -->

## Filtrer les polluants

Le Web d'aujourd'hui est blind√© de salet√©s. La plupart des sites sont bourr√©s de traqueurs, de publicit√©s et de beaucoup d'autres choses d√©sagr√©ables qui p√©nalisent le chargement des sites Web. Pour √©viter cela, les gens utilisent de plus en plus d'AdBlockers[^pr]. Ils offrent une solution simple et rapide (la plupart du temps, une extension de navigateur) qui bloque la plupart des contenus ind√©sirables.

[^pr]: Le taux de p√©n√©tration des bloqueurs publicitaires aux √âtats-Unis est d'environ 30 % sur les ordinateurs de bureau, et d'environ 12 % sur les t√©l√©phones mobiles, selon cette [√©tude eMaketer sur le blocage des publicit√©s √† partir de mars 2017](https://www.statista.com/statistics/351862/adblocking-usage/).

Malheureusement, au niveau de l'UX, les AdBlockers ne font pas toujours l'affaire. Ils augmentent souvent la quantit√© de m√©moire vive et de cycles CPU utilis√©s par votre navigateur Web, ce qui ralentit votre exp√©rience de navigation au lieu de l'am√©liorer. Certains font mieux que d'autres, et des navigateurs entiers[^brave] ont √©t√© con√ßus pour bloquer les contenus ind√©sirables, et font en cela un travail incroyable. Mais le web ne se limite pas √† votre navigateur, n'est-ce pas ?

[^brave]: Si vous n'avez jamais test√© [le navigateur Brave](https://brave.com/), je ne peux que vous encourager √† le faire, et √† rejoindre les 4 millions de personnes qui lui font confiance pour r√©parer leur Web.

Tout votre ordinateur consomme du Web. La plupart des applications grand public sont autant remplies de trackers que n'importe quel site web de Presse. Parfois, vous pouvez m√™me voir les publicit√©s affich√©es dans votre interface utilisateur (_Bonjour, Skype. Oui, je parle de toi, vilain gar√ßon_).

Les AdBlockers ne peuvent rien y faire. Mais un simple fichier hosts, si.

## Hosts‚Ä¶ k√©zako ?

> Le fichier **hosts** est un fichier utilis√© par le syst√®me d'exploitation d'un ordinateur lors de l'acc√®s √† un r√©seau, comme Internet par exemple. Son r√¥le est d'associer des noms d'h√¥tes √† des adresses IP. <cite>"[hosts](https://fr.wikipedia.org/wiki/Hosts)", sur Wikipedia</cite>

Chaque fois que votre navigateur interagit avec un site Web, il requ√™te en r√©alit√© un serveur, identifi√© via son adresse IP, comme 185.31.40.11 (IPv4) ou 2a00:b6e0:1:20:2::1 (IPv6). Cette adresse est assez semblable √† une adresse postale.

Imaginez que vous acc√©dez √† une page web, comme <https://boris.schapira.dev>. Comment votre navigateur sait-il quelle adresse IP contacter ? Eh bien, le navigateur demande simplement √† l'annuaire Internet. Enfin, √† l'un d'entre eux. Et l'annuaire, appel√© <abbr title="Domain Name Server">DNS</abbr>, trouve l'adresse IP correspondante et la donne au navigateur.

Je ne sais pas pour vous, mais moi je n'utilise jamais d'annuaire. La plupart du temps, j'ai recueilli l'adresse des personnes √† qui je veux √©crire dans mon carnet d'adresses personnel et je pioche dedans. C'est exactement √† cela que sert le fichier **h√¥tes**. Chaque fois qu'un processus sur votre ordinateur a besoin d'acc√©der √† une ressource sur Internet, il passe d'abord par le fichier hosts pour savoir o√π la trouver.

Maintenant, imaginons que vous ne vouliez pas que le processus trouve la ressource en question. Rien de plus simple, lancez-le sur une mauvaise piste, en associant le domaine badthings.com √† une adresse non sp√©cifi√©e comme 0.0.0.0.0.

Donc, si quelqu'un fait une liste de tous les domaines contenant des ressources probl√©matiques, nous pouvons tous les rediriger vers 0.0.0.0.0 dans notre fichier hosts, et faire de **notre propre Web** un endroit beaucoup plus sympa.

## Un projet pour tous les rassembler

Il n'y a rien de nouveau dans ce que je d√©cris ici. Les gens cool font √ßa depuis des ann√©es, partageant leurs fichiers h√¥tes. Les sites de <span lang="en">fake news</span>, les plates-formes de jeu d'argent, les groupements de sites pornographiques, les pages qui cryptominent sur votre ordinateurs, les tentatives de fraude et les escroqueries sont tous patiemment identifi√©s et r√©pertori√©s dans des fichiers en acc√®s libre.

J'utilise [ le projet "hosts" de Steven Black](https://github.com/StevenBlack/hosts), un script python, pour les agr√©ger en [un fichier hosts unique de 2MB](https://raw.githubusercontent.com/borisschapira/hosts/main/hosts) contenant plus de 70k domaines. Au cas o√π vous vous poseriez la question : je peux modifier le r√©sultat avec ma propre liste d'acceptation (des domaines qui seraient bloqu√©s normalement, mais dont je veux quand m√™me laisser passer les requ√™tes) et des redirections (ce qui me permet d'√©crire cet article et de v√©rifier le r√©sultat sur https://boris.schapira.local:10443/ qui pointe, en fait, vers ma propre machine).

Si vous n'√™tes pas √† l'aise avec la ligne de commande et utilisez Windows 10, l'application hostsman vous offrira les m√™mes fonctionnalit√©s (_malheureusement, au moment o√π je publie ce billet, le site web ne semble pas joignable. Heureusement, il existe une [version portable](https://portapps.github.io/app/hostsman-portable/) de l'application_).  
Je ne recommanderai pas de modifier votre fichier h√¥te sur les versions pr√©c√©dentes de Windows m√™me si [je le faisais, avant 2015](/notes/2015-08-de-windows-a-mac/), sauf si vous aimez ex√©cuter `ipconfig /flushdns` toutes les 30 minutes. Sur Linux, j'ai vu des gens discuter de [dnscrypt-proxy](https://github.com/jedisct1/dnscrypt-proxy)‚Ä¶ mais je ne l'ai jamais test√©.

{% capture img_alt %}Un capture de la fen√™tre de hostsman, lors de la gestion des sources.{% endcapture %} {% capture img_caption %}Vous pouvez g√©rer des sources pour vos mises √† jour dans hostsman{% endcapture %} {% include rwd-image.html.liquid
path="/assets/images/2018-09-07/hostsman.png"
alt=img_alt
caption=img_caption
%}

## Quelques astuces pratiques

Parfois, j'ai besoin de d√©sactiver temporairement ce fichier hosts. Par exemple, quand j'ai besoin d'aider des clients [Dareboost](https://www.dareboost.com/) √† comprendre l'impact des scripts tiers sur leurs pages (et que j'ai donc besoin de charger ces scripts tiers √©galement).

Pour activer ou d√©sactiver mon fichier hosts, j'utilise une fonction en ligne de commande que j'ai d√©velopp√©e et plac√©e dans mon fichier `~/.profile` [^ozsh]: [^ozsh]: En r√©alit√©, je l'ai mises dans mon `~/.zprofile`, car j'utilise [Oh My ZSH](https://ohmyz.sh/).

```bash
function togglehost() {
    if [ -e /etc/host.bak ]
    then
        sudo mv /etc/host.bak /etc/hosts
        echo "Fichier host r√©activ√©"
    else
        sudo mv /etc/hosts /etc/host.bak
        echo "Fichier hosts mis de c√¥t√©"
    fi
}
```

Une fois cette fonction charg√©e, l'activation ou la d√©sactivation de mon fichier hosts est tr√®s simple :

```terminal
$ togglehost
Fichier hosts mis de c√¥t√©
$ togglehost
Fichier host r√©activ√©
```

Mais comme j'oublie parfois de le remettre en place, j'ai mis en place une routine qui v√©rifie chaque minute que le fichier est bien l√† et, si ce n'est pas le cas, me pr√©vient en utilisant [noti](https://github.com/variadico/noti), de Jaime Pi√±a, pour d√©clencher une notification. Pour ex√©cuter ce contr√¥le r√©gulier, j'utilise `crontab`.

`* * * * * if [ ! -e /etc/hosts ]; then /usr/local/bin/noti -t "Fichier hosts" -m "introuvable"; fi`

Cela fait des ann√©es que j'utilise cette technique et il m'arrive d'oublier que mon fichier hosts me prot√®ge √† ce point. Chaque fois que j'ai besoin d'utiliser l'ordinateur de quelqu'un d'autre, ou de d√©sactiver temporairement mon fichier hosts, je r√©alise le niveau de confort qu'il me procure.

Je suis bien conscient que la manipulation de son propre fichier hosts est une solution efficace mais qui recquiert un certain niveau de comp√©tence technique. Il ne remplace pas compl√®tement un AdBlocker (ou je n'ai pas encore agr√©g√© assez de fichiers) mais c'est un gain de performance incroyable, que je recommande fortement pour la navigation quotidienne.

Essayez par vous-m√™me, et dites-moi ce que vous en pensez !

---

## Synth√®se

Le **fichier hosts** est le carnet d'adresses interne de votre ordinateur qui guident les requ√™tes Web vers les bons serveurs. Remplissez votre fichier hosts avec des domaines pointant dans le vide vous permet de vous assurer que les requ√™tes pointant vers ces domaines √©choueront rapidement et efficacement. Des gens partagent leurs fichiers h√¥tes depuis des ann√©es. Il existe maintenant des solutions pour les concat√©ner, ce qui permet de co-construire une solution pour lutter contre le Web pollu√© auquel nous devons faire face tous les jours.

---

## Bonus

Quelques alternatives sympas √† `localhost` :

```
# http://üëª (localghost)
127.0.0.1 xn--9q8h
# http://üèñÔ∏è (localcoast)
127.0.0.1 xn--km8h
# http://üöΩ (quand le projet n'est pas tr√®s‚Ä¶ motivant)
127.0.0.1 xn--s78h
```

Et bien d'autres [sur Emojipedia](http://üìô.la/)
